<!--moment页面-->
<view class="moment-container">
  <!-- 顶部Banner -->
  <view class="banner">
    <t-image 
      src="https://images.unsplash.com/photo-1506905925346-14bda5d4c4c0?q=80&w=800&auto=format&fit=crop"
      class="banner-image"
      mode="aspectFill"
    />
    <view class="banner-overlay">
      <!-- 左上角：年月日 + 农历日期 -->
      <view class="date-time">
        <view class="date">{{currentDate.year}}年{{currentDate.month}}月{{currentDate.day}}日</view>
        <view class="lunar-date">{{lunarDate}}</view>
      </view>
      
      <!-- 右上角：天气图标 -->
      <view class="weather-icon">
        <text class="weather-emoji">{{weatherInfo.icon}}</text>
      </view>
      
      <!-- 左下角：天气信息 -->
      <view class="weather-info">
        <view class="weather-temp">{{weatherInfo.temp}}°C</view>
        <view class="weather-desc">{{weatherInfo.desc}}</view>
      </view>
      
      <!-- 右下角：倒计时 -->
      <view class="countdown">
        <text class="countdown-text">{{countdownDays}} days since 9/17/2025</text>
      </view>
    </view>
  </view>

  <!-- 动态列表 -->
  <view class="feed-list">
    <view 
      wx:for="{{posts}}" 
      wx:key="id" 
      class="moment-item {{index % 2 === 0 ? 'avatar-left' : 'avatar-right'}}"
    >
      <!-- 头像 -->
      <t-avatar 
        size="40rpx" 
        image="{{item.avatar}}" 
        class="moment-avatar"
      />
      
      <!-- 内容区域 -->
      <view class="moment-content">
        <!-- 文字内容 -->
        <view wx:if="{{item.text}}" class="moment-text">{{item.text}}</view>
        
        <!-- 图片九宫格 -->
        <view wx:if="{{item.images && item.images.length > 0}}" class="moment-images">
          <t-grid column="3" gap="8rpx">
            <t-grid-item wx:for="{{item.images}}" wx:for-item="image" wx:key="*this">
              <t-image 
                src="{{image}}" 
                class="moment-image"
                mode="aspectFill"
              />
            </t-grid-item>
          </t-grid>
        </view>
        
        <!-- 时间 -->
        <view class="moment-time">{{item.time}}</view>
      </view>
    </view>
  </view>

  <!-- 发布按钮 -->
  <t-fab 
    icon="add" 
    bind:click="showPublishPopup"
    class="publish-fab"
  />

  <!-- 发布弹窗 -->
  <t-popup 
    visible="{{showPublish}}" 
    bind:visible-change="onPublishVisibleChange"
    placement="bottom"
    class="publish-popup"
  >
    <view class="publish-content">
      <view class="publish-header">
        <text class="publish-title">发布新动态</text>
        <t-button 
          variant="text" 
          size="small" 
          bind:click="hidePublishPopup"
        >取消</t-button>
      </view>
      
      <view class="publish-form">
        <!-- 文字输入 -->
        <t-textarea 
          value="{{publishText}}"
          bind:change="onTextChange"
          placeholder="这一刻的想法..."
          maxlength="500"
          class="publish-textarea"
        />
        
        <!-- 图片上传 -->
        <t-upload 
          files="{{publishImages}}"
          bind:change="onImageChange"
          max="9"
          gridConfig="{{gridConfig}}"
          class="publish-upload"
        />
        
        <!-- 操作按钮 -->
        <view class="publish-actions">
          <t-button 
            variant="outline" 
            size="medium" 
            bind:click="resetPublish"
            class="publish-reset"
          >清空</t-button>
          <t-button 
            theme="primary" 
            size="medium" 
            bind:click="submitPublish"
            class="publish-submit"
          >发布</t-button>
        </view>
      </view>
    </view>
  </t-popup>

  <!-- Toast提示 -->
  <t-toast id="t-toast" />
</view>